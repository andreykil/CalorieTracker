# CalorieTracker

CalorieTracker — это телеграм-бот для учёта калорий и анализа питания. Он помогает пользователям отслеживать потребление калорий, белков, жиров и углеводов (КБЖУ), добавлять собственные блюда, искать продукты и анализировать питание с помощью статистики и распознавания изображений.

## Функциональность

Бот поддерживает следующие команды:

- **`/start`**  
  Начало работы с ботом. Регистрирует пользователя, выводит краткую инструкцию и предлагает установить цели по КБЖУ, если они ещё не заданы.

- **`/set_goal`**  
  Установка или изменение целей по калориям, белкам, жирам и углеводам. Пользователь вводит значения, которые сохраняются в базе данных.

- **`/search_global`**  
  Поиск базовых продуктов по названию. Бот выводит список подходящих продуктов в inline-клавиатуре. Пользователь может "съесть" продукт, указав вес, или добавить его в избранное с указанием названия и веса порции.

- **`/search_favorite`**  
  Поиск собственных блюд по названию. Бот показывает подходящие блюда в inline-клавиатуре, где пользователь может "съесть" блюдо или удалить его из списка.

- **`/create_favorite`**  
  Создание собственного блюда. Пользователь вводит название, вес, КБЖУ на 100 г и отправляет фотографию. Блюдо сохраняется в списке избранного.

- **`/favorite_from_image`**  
  Добавление блюда в рацион по фото. Бот распознаёт блюдо, сравнивая его с сохранёнными пользовательскими блюдами, и добавляет в съеденное, если сходство выше заданного порога.

- **`/daily_stats`**  
  Вывод статистики питания за указанную дату (в формате DD.MM.YYYY). Показывает потреблённые калории и КБЖУ по сравнению с целями.

## Установка и настройка

1. **Клонирование репозитория**  
   ```bash
    git clone git@github.com:andreykil/CalorieTracker.git
    cd CalorieTracker
   
2. **Создание виртуального окружения**
    ```bash
    python3 -m venv venv
    source venv/bin/activate

3. **Установка зависимостей**  
    ```bash
    pip install -r requirements.txt

4. **Настройка базы данных**  
Установите PostgreSQL и создайте базу данных:
    ```python
   python reset_tables.py

5. **Отредактируйте .env:**
    Напишите в .env DATABASE_URL и TELEGRAM_BOT_TOKEN

6. **Использование**
    ```bash
    python main.py

## Технологии
   
- **Язык: `Python 3.10`**  

- **База данных: `PostgreSQL`**
 
- **`aiogram`** — для создания телеграм-бота.  

- **`SQLAlchemy`** — для работы с базой данных.  

- **`TensorFlow/Keras (ResNet50)`** — для распознавания изображений.  

- **`pandas`** — для импорта данных из Excel.  

- **`numpy`** — для вычислений косинусного сходства.

### Структура проекта

- **`main.py`** 
Основной файл для запуска бота.
- **`database.py`**
Настройка подключения к базе данных.

- **`models.py`**
Модели базы данных (User, GlobalProduct, FavoriteProduct, CalorieEntry).  

- **`bot_commands`**
Реализация команд и интерфейса бота.  

- **`utils`**
Вспомогательные функции для команд бота.

- **`states`**
Состояния для команд бота (ожидание чего-либо)

- **`image_recognition`**
Определение модели для распознавания изображений, функции извлечения вектора признаков и вычисления косинусного сходства

- **`reset_tables`**
Построение таблиц БД и заполнение таблицы global_products продуктами из products.xlsx

